<?xml version="1.0" encoding="UTF-8"?>
<!--
  ACTION MENU - CONTEXTUAL BOTTOM SHEET
  –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–∫—Ä–æ–≤–∞—Ç—å, –∫–æ–º–ø—å—é—Ç–µ—Ä, —Ç–µ–ª–µ—Ñ–æ–Ω, –∏ —Ç.–¥.)

  –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–∞–π–ª—ã:
    - ../SCREENS_SPECIFICATION.xml
    - ../room/RoomPage.xml
    - ../../design/DESIGN_SYSTEM.xml

  –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: docs/prompts/screens/shared/ActionMenu.xml
  –í–µ—Ä—Å–∏—è: 1.0
  –î–∞—Ç–∞: 2026-03-01
-->

<action-menu-specification name="ActionMenu" version="1.0">

  <meta>
    <description>
      –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Ç–∞–ø–µ –ø–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É.
      –û—Ñ–æ—Ä–º–ª–µ–Ω–æ –∫–∞–∫ bottom-sheet, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–π Telegram WebApp.
    </description>
    <invocation>
      <trigger>tap –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç</trigger>
      <optional-trigger>long-press –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π</optional-trigger>
    </invocation>
    <position>bottom-overlay</position>
    <dismiss-actions>tap-outside, swipe-down, back-button</dismiss-actions>
  </meta>

  <!-- –ë–ê–ó–û–í–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
  <layout>
    <backdrop
      color="rgba(15,23,42,0.55)"
      blur="8px"
      z-index="500"
      dismiss-on-tap="true"
    />

    <sheet
      position="bottom"
      width="100%"
      max-width="480px"
      margin-x="auto"
      border-radius="24px 24px 0 0"
      padding="16px 16px 24px 16px"
      background="var(--color-surface, #FFFFFF)"
      elevation="0 -8px 32px rgba(15,23,42,0.35)"
      safe-area-bottom="env(safe-area-inset-bottom)"
    >
      <drag-handle
        width="40px"
        height="4px"
        radius="999px"
        color="rgba(148,163,184,0.6)"
        margin-bottom="12px"
      />

      <header
        display="flex"
        align="center"
        justify="space-between"
        margin-bottom="12px"
        gap="8px"
      >
        <object-info>
          <icon size="24px" />
          <title font-size="1rem" weight="600" />
          <subtitle font-size="0.8rem" color="#6B7280" />
        </object-info>

        <context-tags>
          <tag type="category" />
          <tag type="time-of-day" optional="true" />
        </context-tags>
      </header>

      <actions-list
        type="scrollable"
        max-height="50vh"
        gap="8px"
      />
    </sheet>
  </layout>

  <!-- –≠–õ–ï–ú–ï–ù–¢ –î–ï–ô–°–¢–í–ò–Ø -->
  <action-item-spec>
    <container
      height="56px"
      border-radius="16px"
      padding="12px 14px"
      background="rgba(248,250,252,0.95)"
      hover-background="rgba(241,245,249,1)"
      disabled-background="rgba(15,23,42,0.06)"
      display="flex"
      align="center"
      gap="10px"
    >
      <left-part
        display="flex"
        align="center"
        gap="10px"
        flex-grow="1"
      >
        <icon size="24px" />
        <label-block>
          <label font-size="0.95rem" weight="600" color="#0F172A" />
          <description font-size="0.78rem" color="#6B7280" max-lines="2" />
        </label-block>
      </left-part>

      <right-part
        display="flex"
        direction="column"
        align="flex-end"
        gap="2px"
      >
        <meta-row font-size="0.7rem" color="#9CA3AF">
          <!-- –ü—Ä–∏–º–µ—Ä—ã: "–≠–Ω–µ—Ä–≥–∏—è: -20 ‚Ä¢ –í—Ä–µ–º—è: +2—á" -->
        </meta-row>
        <badges-row display="flex" gap="4px">
          <badge type="energy" />
          <badge type="time" />
          <badge type="reward" />
          <badge type="relationship" />
        </badges-row>
      </right-part>
    </container>

    <states>
      <state name="default">
        <opacity>1.0</opacity>
        <cursor>pointer</cursor>
      </state>
      <state name="pressed">
        <transform>scale(0.97)</transform>
        <background>rgba(226,232,240,1)</background>
        <haptic>light</haptic>
      </state>
      <state name="disabled">
        <opacity>0.45</opacity>
        <cursor>not-allowed</cursor>
        <show>reason-chip</show>
      </state>
    </states>
  </action-item-spec>

  <!-- –ß–ò–ü–´/–ë–ï–ô–î–ñ–ò –ú–ï–¢–ê–ò–ù–§–û–†–ú–ê–¶–ò–ò -->
  <badges-spec>
    <badge type="energy">
      <icon>‚ö°</icon>
      <text format="–≠–Ω–µ—Ä–≥–∏—è: -{value}" />
      <color negative="#F97316" positive="#22C55E" />
    </badge>

    <badge type="time">
      <icon>üïí</icon>
      <text format="+{value}" />
      <color default="#3B82F6" />
    </badge>

    <badge type="reward">
      <icon>üí∞</icon>
      <text format="+{money}" />
      <color default="#22C55E" />
    </badge>

    <badge type="relationship">
      <icon>‚ù§Ô∏è</icon>
      <text format="{target} +{value}" />
      <color default="#EC4899" />
    </badge>

    <badge type="requirement-failed" special="true">
      <icon>‚ö†Ô∏è</icon>
      <text>–£—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã</text>
      <color default="#F97316" />
    </badge>
  </badges-spec>

  <!-- –õ–û–ì–ò–ö–ê –ê–ö–¢–ò–í–ù–û–°–¢–ò/–î–ò–ó–ê–ë–õ–ê -->
  <availability-logic>
    <rule>
      <condition>energy &lt; requiredEnergy</condition>
      <result>action.disabled = true; reason = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏"</result>
    </rule>
    <rule>
      <condition>currentTime not-in allowedTimeRange</condition>
      <result>action.disabled = true; reason = "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è"</result>
    </rule>
    <rule>
      <condition>relationship[target] &lt; minRelationship</condition>
      <result>action.disabled = true; reason = "–ù—É–∂–Ω—ã –ª—É—á—à–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è"</result>
    </rule>
    <rule>
      <condition>missingRequiredItem</condition>
      <result>action.disabled = true; reason = "–ù–µ—Ç –Ω—É–∂–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞"</result>
    </rule>
  </availability-logic>

  <!-- –ê–ù–ò–ú–ê–¶–ò–ò –ü–û–Ø–í–õ–ï–ù–ò–Ø/–ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø -->
  <animations>
    <on-open>
      <backdrop opacity-from="0" opacity-to="1" duration="180ms" easing="ease-out" />
      <sheet
        translateY-from="100%"
        translateY-to="0"
        duration="260ms"
        easing="cubic-bezier(0.25, 0.8, 0.25, 1)"
      />
      <haptic>Telegram.WebApp.HapticFeedback.impactOccurred('medium')</haptic>
    </on-open>

    <on-close>
      <backdrop opacity-from="1" opacity-to="0" duration="160ms" easing="ease-in" />
      <sheet
        translateY-from="0"
        translateY-to="100%"
        duration="220ms"
        easing="ease-in"
      />
    </on-close>
  </animations>

  <!-- –ò–ù–¢–ï–†–ê–ö–¶–ò–Ø –° –û–ë–™–ï–ö–¢–ê–ú–ò -->
  <object-context>
    <input>
      <field>objectId</field>
      <field>objectName</field>
      <field>objectType</field>
      <field>objectIcon</field>
      <field>location</field>
      <field>availableActions[]</field>
    </input>

    <mapping>
      <objectName ‚Üí header.title />
      <objectType ‚Üí header.subtitle />
      <objectIcon ‚Üí header.icon />
      <availableActions ‚Üí actions-list.items />
    </mapping>

    <!-- –ü—Ä–∏–º–µ—Ä: –∫–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç actions, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –º–µ–Ω—é -->
    <action-model>
      <field id="id" />
      <field id="label" />
      <field id="description" />
      <field id="icon" />
      <field id="energyCost" />
      <field id="energyGain" />
      <field id="timeCost" />
      <field id="moneyDelta" />
      <field id="happinessDelta" />
      <field id="relationshipDelta" />
      <field id="requirements[]" />
      <field id="isAvailable" />
      <field id="unavailableReason" />
    </action-model>
  </object-context>

  <!-- –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø (ROOM PAGE) -->
  <examples>
    <example object="bed">
      <objectName>–ö—Ä–æ–≤–∞—Ç—å</objectName>
      <objectType>–û—Ç–¥—ã—Ö</objectType>
      <actions>
        <action id="sleep" label="üò¥ –°–ø–∞—Ç—å 8 —á–∞—Å–æ–≤" description="–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é, –Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –Ω–æ—á—å" />
        <action id="nap" label="üòå –í–∑–¥—Ä–µ–º–Ω—É—Ç—å 1 —á–∞—Å" description="–ù–µ–º–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–ª—ã" />
      </actions>
    </example>

    <example object="computer">
      <objectName>–ö–æ–º–ø—å—é—Ç–µ—Ä</objectName>
      <objectType>–†–∞–±–æ—Ç–∞</objectType>
      <actions>
        <action id="work" label="üíª –†–∞–±–æ—Ç–∞—Ç—å" description="–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–Ω—å–≥–∏ –∏ –æ–ø—ã—Ç" />
        <action id="browse" label="üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç" description="–ù–µ–º–Ω–æ–≥–æ —Ä–∞–∑–≤–ª–µ—á—å—Å—è –∏ –ø–æ–¥–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ" />
      </actions>
    </example>
  </examples>

  <!-- –°–í–Ø–ó–¨ –° –ò–ì–†–û–í–û–ô –õ–û–ì–ò–ö–û–ô -->
  <game-integration>
    <on-action-click>
      <steps>
        <step>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (energy, time, requirements)</step>
        <step>–ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å toast —Å –ø—Ä–∏—á–∏–Ω–æ–π –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é –æ—Ç–∫—Ä—ã—Ç—ã–º</step>
        <step>–ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ ‚Äî –∑–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Å—Ü–µ–Ω–µ</step>
        <step>–ü—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã –∫ –∏–≥—Ä–æ–≤–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é (—Å—Ç–∞—Ç—ã, –≤—Ä–µ–º—è, –¥–µ–Ω—å–≥–∏, –æ—Ç–Ω–æ—à–µ–Ω–∏—è)</step>
        <step>–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π toast/feedback –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ</step>
      </steps>
    </on-action-click>
  </game-integration>

  <!-- –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò -->
  <implementation-requirements>
    <requirement priority="critical">ActionMenu –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –∑–∞ 1 —Ç–∞–ø –ø–æ –æ–±—ä–µ–∫—Ç—É</requirement>
    <requirement priority="critical">–ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ç–∞–ø—É –≤–Ω–µ, —Å–≤–∞–π–ø—É –≤–Ω–∏–∑ –∏–ª–∏ –∫–Ω–æ–ø–∫–µ "–ù–∞–∑–∞–¥"</requirement>
    <requirement priority="high">–°–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π, —Å–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º—ã–π, –Ω–æ –ø–µ—Ä–≤—ã–µ 2‚Äì3 –¥–µ–π—Å—Ç–≤–∏—è –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã –±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞</requirement>
    <requirement priority="high">–ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç –Ω–µ –±–æ–ª–µ–µ –¥–≤—É—Ö —Å—Ç—Ä–æ–∫ –æ–ø–∏—Å–∞–Ω–∏—è</requirement>
    <requirement priority="high">–í—Å—ë —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ CSS transforms –∏ opacity (–±–µ–∑ layout thrash)</requirement>
    <requirement priority="medium">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤–µ—Ç–ª–æ–π/—Ç—ë–º–Ω–æ–π —Ç–µ–º—ã —á–µ—Ä–µ–∑ CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã</requirement>
    <requirement priority="medium">Haptic feedback –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –∏ –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è</requirement>
  </implementation-requirements>

  <!-- –ß–ï–ö–õ–ò–°–¢ FRONTEND -->
  <frontend-checklist>
    <item>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç ActionMenu —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –ø–æ—Ä—Ç–∞–ª—å–Ω—ã–π overlay (React Portal)</item>
    <item>–õ–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (store/–∫–æ–Ω—Ç–µ–∫—Å—Ç)</item>
    <item>–î–æ–±–∞–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫—É –¥–µ–π—Å—Ç–≤–∏–π, –¥–∏–∑–∞–±–ª, –ø—Ä–∏—á–∏–Ω—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏</item>
    <item>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–∞—Ö –∏ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö</item>
    <item>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ ActionMenu –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º —Å–≤–∞–π–ø–æ–º –∑–∞–∫—Ä—ã—Ç–∏—è Telegram WebApp</item>
  </frontend-checklist>

</action-menu-specification>
